{% extends "auctions/layout.html" %}
{% load listingtags %}

{% block body %}


    {% if user == listing.winner %}
        <H2>You have won the auction!</H2>
    {% elif user == listing.seller and listing.winner %}
        <H2>{{ listing.winner }} won your auction!</H2>
    {% elif user == listing.seller and not listing.winner %}
        <H2>Your item did not sell. Would you like to relist?</H2>
    {% elif not listing.winner %}
        <H2>Auction has ended</H2>
    {% endif %}


    {% if user == listing.seller and listing.is_active %}
        <div style="float: right;">
            <a href="{% url 'close' listing.id %}">Close Listing</a>
        </div>
    {% endif %}
   

    <div>
        <div class="">
            <div>
                {% if listing.image %}
                    <img src="{{ listing.image }}" width="500px" height="500px">
                {% else %}
                    <svg width="500" height="500">       
                        <image xlink:href="https://upload.wikimedia.org/wikipedia/commons/a/ac/No_image_available.svg" width="500" height="500"/>    
                    </svg>
                {% endif %}
            </div>
            <div>

                <h2>{{listing.title}}</h2>
                Seller: {{ listing.seller }}

                <hr>
                {% if listing.condition %}
                    Condition: {{ listing.condition }} <br>
                {% else %}
                    Condition: No listed condition<br>
                {% endif %} 

                {% if listing.is_active %}
                    Time left: {{ listing|timeremaining }} | {{  listing|format_endDateTime }}
                {% else %}
                    Time left: Ended
                {% endif %}
                <hr>
                {% if bids.count == 1 %}
                    Current bid: ${{ required_bid }}   [{{ bids.count }} bid]<br>
                {% elif bids.count > 1 %}
                    Current bid: ${{ required_bid }}   [{{ bids.count }} bids]<br>
                {% else %}
                    Starting Bid: ${{ required_bid }} [{{ bids.count }} bids]<br>
                {% endif %}

                {% if listing.is_active %}
                    {% if user != listing.seller %}

                        <form action="{% url 'bid' %}" method="post">
                            {% csrf_token %}
                            
                            {{ bid_form }}
                        
                            <input type="submit", value="Place bid">
                        </form>
                    {% else %}
                        You can't bid on your own listing.
                    {% endif %}
                {% else %}
                    Auction has ended.
                {% endif %}
                <hr>
                
                <form action="{% url 'watchlist' %}" method="get">       
                    <select name="watch_listing" onchange="this.form.submit()">
                        {% if watched %}
                            <option>Listing is in watchlist</option>
                            <option value="remove {{ listing.id }}">Remove from watchlist</option>
                        {% else %}
                            <option>Add to watchlist?</option>
                            <option value="add {{ listing.id }}">Add to watchlist</option>
                        {% endif %}
                    </select>
                </form>
                
            </div>
        </div>
        <hr>
        <div>
            <H3>Description</H3> <br>
            {{ listing.description }}
        </div>
        <hr>
        <div>
            <H3>Comments</H3>
            {% for comment in comments %}
                {{comment.comment_text}} <br>
                asked on {{ comment.comment_dateTime }}
                <hr>
            {% empty %}
                 Currently there are no comments. <br>
            {% endfor %}
            
            {% if user != listing.seller %}
                Have a question of your own? <br>
                <form action="{% url 'comment' %}" method="post">
                    {% csrf_token %}
                    
                    {{ comment_form }}
                
                    <input type="submit", value="Submit question">
            
                </form>
                
            {% endif %}
            
        </div>



    </div>
{% endblock %}